# Spec Review SR-00001 — NetSec StateKit spec.v0.1.0

Date: 2026-02-10  
Spec under review: `spec/spec.v0.1.0.md`

## Reviewer A: Ambiguity Hunter
### BLOCKERS
1) Storage directory layout is not specified (base path, per-environment folder layout, trash semantics). This affects observable behavior and verification.
2) Schemas for `state.json`, `intro.md` structure expectations, `ingest.ndjson`, and `commits.ndjson` are not defined (field list, required vs optional, canonical ordering).
3) API contract is not fully specified (endpoints, request/response payloads, error payload schema, time formats per field).

### NON-BLOCKERS
- Success metrics are measurable but need baseline methodology (how to measure on macOS).

### SPEC DELTAS (exact edits)
- File: `spec/spec.v0.1.0.md`
  - Add new subsection under §5: “Data Model & Schemas” with explicit JSON schemas and canonicalization rules.
  - Add new subsection under §5: “Local Storage Layout” with exact paths.
  - Add new subsection under §5 or §2.3: “API Contract” with endpoint specs.

---

## Reviewer B: Edge Cases & Failure Modes
### BLOCKERS
1) TSF parsing requirements reference “patterns” and “fallback order” but do not specify the required output field list nor the extraction rules per field (regex/xpath) needed for implementability across PAN-OS versions.
2) Dedupe behavior across batch ingest and partial failures is not specified (e.g., if ingest #3 fails, does batch continue? how are timings recorded?).
3) State update atomicity rules exist, but commit/diff generation rules are not explicit (what constitutes canonical state equality, how arrays are sorted, what diff format is stored).

### NON-BLOCKERS
- Error codes list is good; add per-stage mapping to codes for better test coverage.

### SPEC DELTAS (exact edits)
- Add subsection: “TSF Extraction Map (Deterministic)” listing required fields and extraction order per field (runtime section regexes, config xpaths).
- Add subsection: “Batch Failure Policy” defining continue/stop behavior and log fields.
- Add subsection: “Diff & Commit Format” defining `change_paths` calculation and optional diff file.

---

## Reviewer C: Security/Privacy/Abuse Modes
### BLOCKERS
1) UI upload flow implies the browser sends file bytes; spec does not specify safeguards against loading massive archives into memory (server upload handling limits, max upload size, streaming requirement enforcement).
2) No explicit statement about local-only CORS/CSRF model and origin rules (allowed origins, tokens, etc.). This is observable security behavior.

### NON-BLOCKERS
- Offline requirement is clear; add statement banning telemetry.

### SPEC DELTAS (exact edits)
- Add subsection: “Upload Handling & Limits” (max TSF size, streaming upload, backpressure, timeouts).
- Add subsection: “Localhost Security Model” (allowed Origin(s), CSRF token or same-origin policy).

---

## Reviewer D: Testability & Verification
### BLOCKERS
1) Acceptance criteria mention `ingest.ndjson`/`commits.ndjson` but do not define their exact record schemas; tests cannot validate without this.
2) Flow trace and topology inference acceptance criteria do not specify deterministic tie-break rules (overlapping routes, missing zone mapping).
3) Verification steps do not specify concrete commands for local dev builds (how to run backend, where to find environment folder).

### NON-BLOCKERS
- Verification proof artifacts list is good.

### SPEC DELTAS (exact edits)
- Add deterministic rules for:
  - route canonicalization
  - longest-prefix match
  - ignoring default route for adjacency inference
  - unknown zone/interface handling
- Add “Developer Verification Commands” section.

---

## Round Outcome
Outcome: FAIL  
Blockers count: 9

